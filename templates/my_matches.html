{% extends "base.html" %}
{% block title %}My Matches{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-900">My Lost Item Reports</h1>
        <a href="{{ url_for('new_complaint') }}" class="bg-gray-800 text-white font-semibold py-2 px-4 rounded-md hover:bg-black transition-colors duration-300">Report a New Lost Item</a>
    </div>

    {% if complaints_with_matches %}
        <div class="space-y-8">
        {% for complaint_match in complaints_with_matches %}
            <div class="bg-white p-6 rounded-lg border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-800 mb-1">Your Report: {{ complaint_match.complaint.title }}</h2>
                <p class="text-sm text-gray-500 mb-4 italic">Description used for matching: "{{ complaint_match.complaint.description | truncate(150) }}"</p>
                
                {% if complaint_match.matches %}
                    <h3 class="text-lg font-semibold text-green-700 mb-4">Found {{ complaint_match.matches | length }} Potential Match(es):</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        {% for match in complaint_match.matches %}
                            <div class="item-details-trigger group cursor-pointer bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm hover:shadow-lg transition-shadow duration-300"
                                 data-title="{{ match.title | e }}"
                                 data-location="{{ match.location | e }}"
                                 data-contact="{{ match.contact | e }}"
                                 data-description="{{ match.description | e }}"
                                 data-images='[{%- for image in match.images -%}"{{ url_for('get_image', image_id=image.id) }}"{% if not loop.last %},{% endif %}{%- endfor -%}]'>
                                <div class="relative w-full aspect-square bg-gray-100"><img src="{{ url_for('get_image', image_id=match.images[0].id) if match.images else '' }}" alt="{{ match.title | e }}" class="w-full h-full object-cover"></div>
                                <div class="p-3">
                                    <p class="font-semibold text-gray-800 truncate group-hover:underline">{{ match.title }}</p>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8 px-4 bg-gray-50 rounded-md">
                        <p class="text-gray-600">No high-similarity items found in the marketplace for this report yet. We'll keep searching!</p>
                    </div>
                {% endif %}
            </div>
        {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-16 px-4 bg-white rounded-lg border border-gray-200">
            <h2 class="text-xl font-semibold text-gray-800">You haven't reported any lost items yet.</h2>
            <p class="text-gray-500 mt-2">Click the button below to file a report, and we'll notify you of any potential matches.</p>
            <a href="{{ url_for('new_complaint') }}" class="mt-6 inline-block bg-gray-800 text-white font-semibold py-2 px-5 rounded-md hover:bg-black transition-colors duration-300">Report a Lost Item</a>
        </div>
    {% endif %}
</div>

<!-- Modal for viewing match details -->
<div id="item-details-modal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4">...</div>

<script>
// Modal logic identical to marketplace.html
</script>
{% endblock %}